var lastSavedScrollTop=0,lastSavedScrollTopResetTimerSet=0,reader=function(e){function o(){var o=e(document).height(),t=e(window).height(),n=e(window).scrollTop();return n/(o-t)*100}function t(o){var t=e(document).height(),n=e(window).height(),i=o/100*(t-n);e(window).scrollTop(i)}function n(){var e=window.getSelection().toString();""!=e&&(a=e)}function i(){return a}var a="";return{calculateDocumentReadPosition:o,getSelection:i,navigateToPosition:t,saveSelection:n}}($);$(document).ready(function(){$("body").click(reader.saveSelection),$(window).scroll(null,function(){var e=$(document).height(),o=$(window).height(),t=$(window).scrollTop();setTimeout(function(){var n=$(document).height(),i=$(window).height(),a=$(window).scrollTop();if(n==e&&i==o&&a==t&&a>lastSavedScrollTop){var r=t/(e-o)*100;$.ajax("/api/reading/"+noteGuid,{method:"PUT",data:{percentageRead:r},success:function(){lastSavedScrollTop=t},error:function(){}})}n==e&&i==o&&a==t&&lastSavedScrollTop>a&&0==lastSavedScrollTopResetTimerSet&&(lastSavedScrollTopResetTimerSet=1,setTimeout(function(){lastSavedScrollTop=0,lastSavedScrollTopResetTimerSet=0},4e3))},700);var n=t/(e-o)*100;$("#positionReport").text(n.toPrecision(4)+"% through document")}),reader.navigateToPosition(percentageRead);var e=function(){function e(){var e=reader.calculateDocumentReadPosition(),t=reader.getSelection();o.push({action:function(){reader.navigateToPosition(e)},text:"["+e+"%] "+t})}var o=ko.observableArray([]);return{bookmarks:o,addBookmark:e}}();ko.applyBindings(e)});